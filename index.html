<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT Content Generator & WordPress Publisher</title>

    <!-- Inject environment variables -->
    <script>
        window.env = {
            OPENAI_API_KEY: "<%= NEXT_PUBLIC_OPENAI_API_KEY %>",
            WORDPRESS_JWT_TOKEN: "<%= NEXT_PUBLIC_WORDPRESS_JWT_TOKEN %>"
        };
    </script>

    <script>
        async function generateContent(event) {
            event.preventDefault();

            try {
                // Collect inputs from form fields
                const keywords = document.getElementById("keywords").value;
                const contentType = document.getElementById("content_type").value;
                const tone = document.getElementById("tone").value;

                // Access environment variables from window.env
                const chatGPTApiKey = window.env.OPENAI_API_KEY;
                const wpApiToken = window.env.WORDPRESS_JWT_TOKEN;

                // Debugging logs
                console.log("OpenAI API Key:", chatGPTApiKey);
                console.log("WordPress JWT Token:", wpApiToken);

                if (!chatGPTApiKey || !wpApiToken) {
                    throw new Error("Environment variables are missing. Ensure they are set correctly.");
                }

                const chatGPTApiUrl = "https://api.openai.com/v1/chat/completions";
                const prompt = `Generate a ${tone} ${contentType} with keywords: ${keywords}.`;

                const chatGPTRequestBody = {
                    model: "gpt-3.5-turbo",
                    messages: [
                        { role: "system", content: "You are a helpful assistant." },
                        { role: "user", content: prompt }
                    ],
                    max_tokens: 1500
                };

                // Call ChatGPT API
                const chatGPTResponse = await fetch(chatGPTApiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${chatGPTApiKey}`
                    },
                    body: JSON.stringify(chatGPTRequestBody)
                });

                if (!chatGPTResponse.ok) {
                    throw new Error(`ChatGPT API Error: ${chatGPTResponse.statusText}`);
                }

                const chatGPTData = await chatGPTResponse.json();
                const generatedContent = chatGPTData.choices[0].message.content;

                // Display the generated content
                document.getElementById("result").textContent = generatedContent;

                const wpRequestBody = {
                    title: `Generated Content - ${keywords}`,
                    content: generatedContent,
                    status: "publish" // Change to 'draft' if needed
                };

                const wpApiUrl = "https://fitnessbodybuildingvolt.com/wp-json/wp/v2/posts";

                // Post to WordPress
                const wpResponse = await fetch(wpApiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${wpApiToken}`
                    },
                    body: JSON.stringify(wpRequestBody)
                });

                if (!wpResponse.ok) {
                    throw new Error(`WordPress API Error: ${wpResponse.statusText}`);
                }

                const wpData = await wpResponse.json();
                alert(`Content posted to WordPress! View it at: ${wpData.link}`);
            } catch (error) {
                console.error("Error:", error);
                document.getElementById("result").textContent = "An error occurred. Check the console for details.";
            }
        }
    </script>
</head>
<body>
    <h1>ChatGPT Content Generator & WordPress Publisher</h1>
    <form id="contentForm" onsubmit="generateContent(event)">
        <label for="keywords">Keywords:</label>
        <input type="text" id="keywords" required>
        <label for="content_type">Content Type:</label>
        <input type="text" id="content_type" required>
        <label for="tone">Tone:</label>
        <input type="text" id="tone" required>
        <button type="submit">Generate Content</button>
    </form>

    <h2>Generated Content:</h2>
    <pre id="result"></pre>
</body>
</html>
