<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT Content Generator & WordPress Publisher</title>

    <!-- Link to favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <script>
        async function generateContent(event) {
            event.preventDefault();

            try {
                // Collect inputs from form fields
                const keywords = document.getElementById("keywords").value;
                const contentType = document.getElementById("content_type").value;
                const tone = document.getElementById("tone").value;
                const audience = document.getElementById("audience").value;
                const wordCount = document.getElementById("word_count").value;
                const structure = document.getElementById("structure").value;
                const seoKeywords = document.getElementById("seo_keywords").value;
                const cta = document.getElementById("cta").value;
                const includeImages = document.getElementById("images").value === "true";
                const format = document.getElementById("format").value;
                const language = document.getElementById("language").value;

                // Prepare the prompt for ChatGPT
                const prompt = `
                    Generate a ${tone} ${contentType} targeted at ${audience}.
                    Keywords: ${keywords}.
                    SEO Keywords: ${seoKeywords}.
                    Word Count: ${wordCount}.
                    Structure: ${structure}.
                    Call-to-Action: ${cta}.
                    Format: ${format}.
                    Language: ${language}.
                    Include Images: ${includeImages ? "Yes" : "No"}.
                `;

                // Access environment variables
                const chatGPTApiKey = process.env.NEXT_PUBLIC_OPENAI_API_KEY;
                const wpApiToken = process.env.NEXT_PUBLIC_WORDPRESS_JWT_TOKEN;

                console.log("ChatGPT API Key:", chatGPTApiKey);
                console.log("WordPress JWT Token:", wpApiToken);

                if (!chatGPTApiKey || !wpApiToken) {
                    throw new Error("Environment variables are missing. Ensure they are set correctly.");
                }

                const chatGPTApiUrl = "https://api.openai.com/v1/chat/completions";
                const wpApiUrl = "https://fitnessbodybuildingvolt.com/wp-json/wp/v2/posts";

                const chatGPTRequestBody = {
                    model: "gpt-3.5-turbo",
                    messages: [
                        { role: "system", content: "You are a helpful assistant." },
                        { role: "user", content: prompt }
                    ],
                    max_tokens: 1500
                };

                // Call ChatGPT API
                const chatGPTResponse = await fetch(chatGPTApiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${chatGPTApiKey}`
                    },
                    body: JSON.stringify(chatGPTRequestBody)
                });

                if (!chatGPTResponse.ok) {
                    throw new Error(`ChatGPT API Error: ${chatGPTResponse.statusText}`);
                }

                const chatGPTData = await chatGPTResponse.json();
                const generatedContent = chatGPTData.choices[0].message.content;

                // Display the generated content
                document.getElementById("result").textContent = generatedContent;

                const wpRequestBody = {
                    title: `Generated Content - ${keywords}`,
                    content: generatedContent,
                    status: "publish" // Change to 'draft' if you want to save without publishing
                };

                // Post to WordPress
                const wpResponse = await fetch(wpApiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${wpApiToken}`
                    },
                    body: JSON.stringify(wpRequestBody)
                });

                if (!wpResponse.ok) {
                    throw new Error(`WordPress API Error: ${wpResponse.statusText}`);
                }

                const wpData = await wpResponse.json();
                alert(`Content posted to WordPress! View it at: ${wpData.link}`);
            } catch (error) {
                console.error("Error:", error);
                document.getElementById("result").textContent = "An error occurred. Check the console for details.";
            }
        }
    </script>
</head>
<body>
    <h1>ChatGPT Content Generator & WordPress Publisher</h1>
    <form id="contentForm" onsubmit="generateContent(event)">
        <!-- Form Fields -->
        <label for="keywords">Keywords:</label>
        <input type="text" id="keywords" required>
        <label for="content_type">Content Type:</label>
        <input type="text" id="content_type" required>
        <label for="tone">Tone:</label>
        <input type="text" id="tone" required>
        <button type="submit">Generate and Publish</button>
    </form>

    <!-- Result Section -->
    <h2>Generated Content:</h2>
    <pre id="result"></pre>
</body>
</html>
